schemaVersion: '2.0'
machine:
  java:
    version: 11-openjdk
  env:
    RUNTIME_JDK_VERSION: 11-openjdk
publish:
  libraries:
    repo: m2:oss-patched
  reports:
    junit: true

builds:
  - branchName: apple
    name: apple-prb
    build:
      template: buildozer:v4:prb
    machine:
      env:
        RUNTIME_JDK_VERSION: 11
        skipIntegrationTest: true

  - branchName: apple
    name: apple-release
    build:
      template: buildozer:v4:publish
    trigger:
      gitPush: false
    package:
      libraries:
        - publish:
            - repo: m2:maps
      release: true
    finally:
      tag:
        enabled: true
        expression: $(cat gradle.properties | grep -oP 'version=\K.+')

  - branchName: hotfix
    name: hotfix-prb
    build:
      template: buildozer:v4:prb

  - branchName: hotfix
    name: hotfix-release
    build:
      template: buildozer:v4:publish
    trigger:
      gitPush: false
    publish:
      release: true
      libraries: true

